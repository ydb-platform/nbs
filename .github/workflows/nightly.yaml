name: Nightly build
on:
  schedule:
    - cron: "0 1 * * *"
  workflow_dispatch:

jobs:
  build:
    strategy:
      max-parallel: ${{ fromJson(github.event_name == 'workflow_dispatch' && 3 || 8) }}
      fail-fast: false
      matrix:
        build:
        - relwithdebinfo
        - release-asan
        - release-tsan
    name: Build/test x86_64 using YA (${{ matrix.build }})
    uses: ./.github/workflows/build_and_test_on_demand.yaml
    secrets: inherit
    with:
      build_preset: ${{ matrix.build }}
      cache_update_build: true
      cache_update_tests: false
      test_threads: 6
